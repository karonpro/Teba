{% extends 'base.html' %}
{% load custom_filters %}
{% block content %}
<div class="card p-3">
  <h2>Transaction Report</h2>

  <!-- Filter -->
  <form method="get" class="row g-2 mb-3">
    <div class="col-auto"><input type="date" name="start" value="{{ start }}" class="form-control"></div>
    <div class="col-auto"><input type="date" name="end" value="{{ end }}" class="form-control"></div>
    <div class="col-auto">
      <select name="location" class="form-select">
        <option value="">All Locations</option>
        {% for loc in locations %}
          <option value="{{ loc.id }}" {% if selected_location == loc.id|stringformat:"s" %}selected{% endif %}>{{ loc.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto"><button type="submit" class="btn btn-secondary">Filter</button></div>
  </form>

  <!-- Table -->
  <table class="table table-striped table-dark">
    <thead>
      <tr>
        <th>Date</th>
        <th>Location</th>
        <th>Opening Balance</th>
        <th>Customer Balance</th>
        <th>Paid</th>
        <th>Wholesale</th>
        <th>Debt</th>
        <th>Accounts</th>
        <th>Expenses</th>
        <th>Cash</th>
        <th>Difference</th>
        <th>Less/Excess</th>
      </tr>
    </thead>
    <tbody>
      {% for t in transactions %}
      <tr>
        <td>{{ t.date }}</td>
        <td>{{ t.location.name|default:"-" }}</td>
        <td>{{ t.opening_balance|floatformat:2 }}</td>
        <td>{{ t.customer_balance|floatformat:2 }}</td>
        <td>{{ t.paid|floatformat:2 }}</td>
        <td>{{ t.wholesale|floatformat:2 }}</td>
        <td>{{ t.debt|floatformat:2 }}</td>
        <td>{{ t.accounts|floatformat:2 }}</td>
        <td>{{ t.expenses|floatformat:2 }}</td>
        <td>{{ t.cash|floatformat:2 }}</td>
        <td>{{ t.difference|floatformat:2 }}</td>
        <td>{{ t.less_excess|floatformat:2 }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="12">No transactions found.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Totals -->
  <div class="mt-3">
    <strong>Totals:</strong><br>
    Opening Balance: {{ totals.opening_balance|floatformat:2 }} |
    Customer Balance: {{ totals.customer_balance|floatformat:2 }} |
    Paid: {{ totals.paid|floatformat:2 }} |
    Wholesale: {{ totals.wholesale|floatformat:2 }} |
    Debt: {{ totals.debt|floatformat:2 }} |
    Accounts: {{ totals.accounts|floatformat:2 }} |
    Expenses: {{ totals.expenses|floatformat:2 }} |
    Cash: {{ totals.cash|floatformat:2 }} |
    Difference: {{ totals.difference|floatformat:2 }} |
    Less/Excess: {{ totals.less_excess|floatformat:2 }}
  </div>
</div>
{% endblock %}